# Advanced Portfolio Analytics - Factor Analysis

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–ª—É–±–æ–∫—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–∞–º:
- **–°–µ–∫—Ç–æ—Ä–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è** - –∞–Ω–∞–ª–∏–∑ –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º (–§–∏–Ω–∞–Ω—Å—ã, –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞, –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Ç.–¥.)
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏** - Large/Mid/Small Cap
- **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –†–æ—Å—Å–∏—è, –°–®–ê, –ï–≤—Ä–æ–ø–∞, –ê–∑–∏—è
- **–í–∞–ª—é—Ç–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è** - RUB, USD, EUR, CNY
- **–ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏** - HHI, —Ç–æ–ø –ø–æ–∑–∏—Ü–∏–∏
- **–û—Ü–µ–Ω–∫–∞ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏** - –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º, –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏, –≤–∞–ª—é—Ç–∞–º
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∏—Å–∫–æ–≤** - –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Nov 2025 Refactoring)

Portfolio Analytics –±—ã–ª —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω –≤ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:

**–î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 1 –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª `portfolio-analysis.ts` (624 —Å—Ç—Ä–æ–∫–∏)
**–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 15 —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (–∫–∞–∂–¥—ã–π < 150 —Å—Ç—Ä–æ–∫)

```
src/lib/analytics/portfolio/
‚îú‚îÄ‚îÄ constants.ts                     # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ data/                            # –î–∞–Ω–Ω—ã–µ-—Å–ª–æ–≤–∞—Ä–∏ (–ª–µ–≥–∫–æ –æ–±–Ω–æ–≤–ª—è—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ moex-benchmark.ts            # –í–µ—Å–∞ –∏–Ω–¥–µ–∫—Å–∞ MOEX
‚îÇ   ‚îú‚îÄ‚îÄ sector-map.ts                # –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–∫–µ—Ä–æ–≤ ‚Üí —Å–µ–∫—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ geography-map.ts             # –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–∫–µ—Ä–æ–≤ ‚Üí —Ä–µ–≥–∏–æ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ market-cap-map.ts            # –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–∫–µ—Ä–æ–≤ ‚Üí –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ classifiers/
‚îÇ   ‚îú‚îÄ‚îÄ sector-classifier.ts         # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ geography-classifier.ts      # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ market-cap-classifier.ts     # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ currency-classifier.ts       # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –≤–∞–ª—é—Ç–µ
‚îú‚îÄ‚îÄ calculators/
‚îÇ   ‚îú‚îÄ‚îÄ concentration.ts             # HHI, —Ç–æ–ø –ø–æ–∑–∏—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ sector-exposure.ts           # –°–µ–∫—Ç–æ—Ä–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ market-cap-exposure.ts       # –≠–∫—Å–ø–æ–∑–∏—Ü–∏—è –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ geography-exposure.ts        # –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ currency-exposure.ts         # –í–∞–ª—é—Ç–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ tilt-calculator.ts           # –§–∞–∫—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∫–ª–æ–Ω—ã
‚îú‚îÄ‚îÄ enrichment.ts                    # –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏
‚îú‚îÄ‚îÄ factor-analyzer.ts               # –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (calculateFactorAnalysis)
‚îî‚îÄ‚îÄ index.ts                         # Public API
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–∫–µ—Ä—ã –≤ data/ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏
- ‚úÖ –ö–∞–∂–¥—ã–π calculator —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ classifiers –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–æ–≤—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ~80% –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è AI Code Assistant

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ ‚Üí [CLAUDE.md](../../CLAUDE.md#-modular-architecture-nov-2025-refactoring)

**Analytics Store —Ç–∞–∫–∂–µ –º–æ–¥—É–ª—å–Ω—ã–π:**
```
src/stores/analytics/
‚îú‚îÄ‚îÄ types.ts                         # –¢–∏–ø—ã store
‚îú‚îÄ‚îÄ schemas.ts                       # Zod validation
‚îú‚îÄ‚îÄ analytics-store.ts               # –ì–ª–∞–≤–Ω—ã–π store (–¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç actions)
‚îú‚îÄ‚îÄ history-loader.ts                # loadHistory action
‚îú‚îÄ‚îÄ factor-loader.ts                 # loadFactorAnalysis action
‚îî‚îÄ‚îÄ index.ts

src/lib/http/                        # ‚ú® –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ HTTP —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ error-classifier.ts              # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ fetch-utils.ts                   # Timeout, backoff, parse
‚îú‚îÄ‚îÄ retry.ts                         # Retry —Å exponential backoff
‚îî‚îÄ‚îÄ index.ts
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ portfolio/               # ‚ú® –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Å–º. –≤—ã—à–µ)
‚îÇ   ‚îî‚îÄ‚îÄ http/                        # ‚ú® –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ HTTP —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ analytics.ts                 # TypeScript —Ç–∏–ø—ã –¥–ª—è —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îî‚îÄ‚îÄ analytics/                   # ‚ú® –ú–æ–¥—É–ª—å–Ω—ã–π store (—Å–º. –≤—ã—à–µ)
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ analytics/
‚îÇ           ‚îî‚îÄ‚îÄ factors/
‚îÇ               ‚îî‚îÄ‚îÄ route.ts         # API endpoint –¥–ª—è —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ features/
        ‚îî‚îÄ‚îÄ Analytics/
            ‚îú‚îÄ‚îÄ PortfolioFactors.tsx # –ì–ª–∞–≤–Ω—ã–π dashboard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
            ‚îî‚îÄ‚îÄ FactorAnalysis/
                ‚îú‚îÄ‚îÄ SectorExposure.tsx     # –°–µ–∫—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
                ‚îú‚îÄ‚îÄ MarketCapExposure.tsx  # –ê–Ω–∞–ª–∏–∑ –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
                ‚îú‚îÄ‚îÄ GeographyExposure.tsx  # –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
                ‚îî‚îÄ‚îÄ CurrencyExposure.tsx   # –í–∞–ª—é—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. PortfolioFactors.tsx (–ì–ª–∞–≤–Ω—ã–π Dashboard)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—á–µ—Ç–∞
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (Pie/Bar charts)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —Ñ–∞–∫—Ç–æ—Ä–∞ (–í—Å–µ/–°–µ–∫—Ç–æ—Ä–∞/–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è/–ì–µ–æ–≥—Ä–∞—Ñ–∏—è/–í–∞–ª—é—Ç—ã)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ (HHI, —Ç–æ–ø –ø–æ–∑–∏—Ü–∏–∏)
- –û—Ü–µ–Ω–∫–∞ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–∞–º
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∏—Å–∫–æ–≤ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```tsx
import PortfolioFactors from '@/components/features/Analytics/PortfolioFactors';

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
<PortfolioFactors />
```

**Props:** –ù–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Zustand stores)

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- Loading - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- Error - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–≤—Ç–æ—Ä–∞
- Empty - –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞)
- Success - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 2. SectorExposure.tsx

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º —Å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Å –±–µ–Ω—á–º–∞—Ä–∫–æ–º MOEX.

**Props:**
```tsx
interface SectorExposureProps {
  data: SectorExposure[];      // –î–∞–Ω–Ω—ã–µ —Å–µ–∫—Ç–æ—Ä–Ω–æ–π —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏
  showBenchmark?: boolean;     // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å MOEX (default: true)
  viewMode?: 'pie' | 'bar';   // –†–µ–∂–∏–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (default: 'pie')
}
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–µ–∫—Ç–æ—Ä—ã:**
- `finance` - –§–∏–Ω–∞–Ω—Å—ã (Sberbank, VTB)
- `energy` - –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞ (Gazprom, Lukoil, Rosneft)
- `materials` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (Norilsk Nickel, NLMK)
- `tech` - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (Yandex, VK, Ozon)
- `telecom` - –¢–µ–ª–µ–∫–æ–º (MTS, Rostelecom)
- `consumer` - –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π —Å–µ–∫—Ç–æ—Ä (Magnit, X5)
- `utilities` - –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (Inter RAO, RusHydro)
- `industrial` - –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å (NLMK, TMK)
- `healthcare` - –ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- `realestate` - –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
- `other` - –ü—Ä–æ—á–µ–µ

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- Pie/Bar chart –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –±–µ–Ω—á–º–∞—Ä–∫–∞ MOEX (overweight/underweight)
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ tooltip (—Å—Ç–æ–∏–º–æ—Å—Ç—å, –¥–æ–ª—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π)
- –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π (> 2%)

### 3. MarketCapExposure.tsx

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–∞–Ω–∏–π.

**Props:**
```tsx
interface MarketCapExposureProps {
  data: MarketCapExposure[];   // –î–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
  viewMode?: 'pie' | 'bar';   // –†–µ–∂–∏–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (default: 'pie')
}
```

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏:**
- `large` - Large Cap (> 200 –º–ª—Ä–¥ ‚ÇΩ)
- `mid` - Mid Cap (10-200 –º–ª—Ä–¥ ‚ÇΩ)
- `small` - Small Cap (< 10 –º–ª—Ä–¥ ‚ÇΩ)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- Large Cap > 70% ‚Üí –¥–æ–±–∞–≤–∏—Ç—å Mid/Small Cap –¥–ª—è —Ä–æ—Å—Ç–∞
- Small Cap > 30% ‚Üí –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤—ã—Å–æ–∫–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Üí –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫/–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å

### 4. GeographyExposure.tsx

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è —Å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Å MOEX.

**Props:**
```tsx
interface GeographyExposureProps {
  data: GeographyExposure[];   // –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
  showBenchmark?: boolean;     // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å MOEX (default: true)
  viewMode?: 'pie' | 'bar';   // –†–µ–∂–∏–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (default: 'pie')
}
```

**–†–µ–≥–∏–æ–Ω—ã:**
- `russia` üá∑üá∫ - –†–æ—Å—Å–∏–π—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- `usa` üá∫üá∏ - –ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- `europe` üá™üá∫ - –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- `asia` üåè - –ê–∑–∏–∞—Ç—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- `other` üåç - –ü—Ä–æ—á–∏–µ —Ä–µ–≥–∏–æ–Ω—ã

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –°–≤–æ–¥–∫–∞: –†–æ—Å—Å–∏–π—Å–∫–∏–µ vs –ó–∞—Ä—É–±–µ–∂–Ω—ã–µ –∞–∫—Ç–∏–≤—ã
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –±–µ–Ω—á–º–∞—Ä–∫–∞ MOEX
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º —Å emoji —Ñ–ª–∞–≥–∞–º–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- Russia > 95% ‚Üí —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—Ä—É–±–µ–∂–Ω—ã–µ –∞–∫—Ç–∏–≤—ã
- Foreign > 50% ‚Üí —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–∞–ª—é—Ç–Ω—ã–µ –∏ –≥–µ–æ–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
- 70-90% Russia ‚Üí —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è

### 5. CurrencyExposure.tsx

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ –≤–∞–ª—é—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è.

**Props:**
```tsx
interface CurrencyExposureProps {
  data: CurrencyExposure[];    // –í–∞–ª—é—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  viewMode?: 'pie' | 'bar';   // –†–µ–∂–∏–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (default: 'pie')
}
```

**–í–∞–ª—é—Ç—ã:**
- `RUB` ‚ÇΩ - –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å
- `USD` $ - –î–æ–ª–ª–∞—Ä –°–®–ê
- `EUR` ‚Ç¨ - –ï–≤—Ä–æ
- `CNY` ¬• - –ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å
- `other` üí± - –ü—Ä–æ—á–∏–µ –≤–∞–ª—é—Ç—ã

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –°–≤–æ–¥–∫–∞: –†—É–±–ª–µ–≤—ã–µ vs –ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–∞—è –≤–∞–ª—é—Ç–∞
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤–∞–ª—é—Ç–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –≤–∞–ª—é—Ç–∞–º
- –ê–Ω–∞–ª–∏–∑ –≤–∞–ª—é—Ç–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- RUB > 95% ‚Üí –Ω–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –¥–µ–≤–∞–ª—å–≤–∞—Ü–∏–∏
- Foreign currency > 60% ‚Üí –≤—ã—Å–æ–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫—É—Ä—Å–∞
- 60-80% RUB ‚Üí —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- 20-40% Foreign ‚Üí —É–º–µ—Ä–µ–Ω–Ω–∞—è –≤–∞–ª—é—Ç–Ω–∞—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

## API Routes

### GET /api/analytics/factors

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è.

**Query Parameters:**
- `accountId` (required) - ID —Å—á–µ—Ç–∞ Tinkoff

**Response:**
```json
{
  "success": true,
  "data": {
    "sectorExposure": [
      {
        "sector": "finance",
        "value": 1500000,
        "weight": 35.5,
        "count": 3,
        "benchmarkWeight": 28.5,
        "deviation": 7.0
      }
    ],
    "marketCapExposure": [...],
    "geographyExposure": [...],
    "currencyExposure": [...],
    "concentrationMetrics": {
      "topPositionWeight": 25.3,
      "top5PositionsWeight": 68.2,
      "top10PositionsWeight": 89.5,
      "herfindahlIndex": 0.145
    },
    "diversificationScore": {
      "overall": 0.855,
      "bySector": 0.72,
      "byGeography": 0.15,
      "byCurrency": 0.25
    },
    "factorTilts": {
      "sectorTilts": [
        {
          "sector": "finance",
          "tilt": 7.0,
          "significance": "medium"
        }
      ],
      "geographyTilts": [...]
    },
    "riskIndicators": {
      "sectorConcentrationRisk": "low",
      "geographyConcentrationRisk": "high",
      "currencyConcentrationRisk": "high"
    }
  },
  "metadata": {
    "accountId": "12345",
    "positionsCount": 15,
    "totalValue": 4230000,
    "timestamp": "2024-01-15T10:30:00.000Z",
    "duration": 234
  }
}
```

**Error Response:**
```json
{
  "success": false,
  "error": "Failed to calculate factor analysis",
  "details": "Error message"
}
```

**Implementation Details:**
1. –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å —á–µ—Ä–µ–∑ Tinkoff API
2. –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
3. –í—ã–∑—ã–≤–∞–µ—Ç `calculateFactorAnalysis()` –∏–∑ `@/lib/analytics/portfolio` (–º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

## Zustand Store

### Analytics Store Methods

```typescript
interface AnalyticsState {
  // Factor Analysis State
  factorAnalysis: FactorAnalysis | null;
  factorLoading: boolean;
  factorError: string | null;

  // Factor Analysis Actions
  loadFactorAnalysis: (accountId: string) => Promise<void>;
  clearFactorAnalysis: () => void;
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Store

```tsx
import { useAnalyticsStore } from '@/stores/analyticsStore';

function MyComponent() {
  const {
    factorAnalysis,
    factorLoading,
    factorError,
    loadFactorAnalysis,
    clearFactorAnalysis
  } = useAnalyticsStore();

  useEffect(() => {
    loadFactorAnalysis('account-id');

    return () => {
      clearFactorAnalysis();
    };
  }, []);

  if (factorLoading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  if (factorError) return <div>–û—à–∏–±–∫–∞: {factorError}</div>;
  if (!factorAnalysis) return <div>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>;

  return (
    <div>
      {/* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö */}
      {factorAnalysis.sectorExposure.map(...)}
    </div>
  );
}
```

## –õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ (–º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

–õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ –º–æ–¥—É–ª—è–º –≤ `@/lib/analytics/portfolio/`. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `enrichPositions()`
–û–±–æ–≥–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è —Ñ–∞–∫—Ç–æ—Ä–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏:
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ–∫—Ç–æ—Ä –ø–æ ticker
- –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—é
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—é
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞–ª—é—Ç—É

#### `calculateSectorExposure()`
–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–µ–∫—Ç–æ—Ä–Ω—É—é —ç–∫—Å–ø–æ–∑–∏—Ü–∏—é:
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º
- –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –≤–µ—Å –∫–∞–∂–¥–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –±–µ–Ω—á–º–∞—Ä–∫–æ–º MOEX
- –í—ã—á–∏—Å–ª—è–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (overweight/underweight)

#### `calculateMarketCapExposure()`
–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏:
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ Large/Mid/Small Cap
- –í—ã—á–∏—Å–ª—è–µ—Ç –≤–µ—Å–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

#### `calculateGeographyExposure()`
–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å MOEX –±–µ–Ω—á–º–∞—Ä–∫–æ–º
- –í—ã—á–∏—Å–ª—è–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

#### `calculateCurrencyExposure()`
–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤–∞–ª—é—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ –≤–∞–ª—é—Ç–∞–º
- –í—ã—á–∏—Å–ª—è–µ—Ç –≤–µ—Å–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

#### `calculateFactorAnalysis()`
–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è:
1. –û–±–æ–≥–∞—â–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏
2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏
3. –í—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ (HHI, —Ç–æ–ø –ø–æ–∑–∏—Ü–∏–∏)
4. –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—é
5. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∞–∫—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∫–ª–æ–Ω—ã (tilts)
6. –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–∏—Å–∫–∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏

### –ú–µ—Ç—Ä–∏–∫–∏

#### Herfindahl-Hirschman Index (HHI)
–ò–Ω–¥–µ–∫—Å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è:
```
HHI = Œ£(weight_i)¬≤
```
- HHI >= 0.25 ‚Üí –í—ã—Å–æ–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è
- 0.15 <= HHI < 0.25 ‚Üí –°—Ä–µ–¥–Ω—è—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è
- HHI < 0.15 ‚Üí –ù–∏–∑–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è (—Ö–æ—Ä–æ—à–∞—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è)

#### Diversification Score
```
Diversification = 1 - HHI
```
- –ß–µ–º –±–ª–∏–∂–µ –∫ 1, —Ç–µ–º –ª—É—á—à–µ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è:
  - –û–±—â–µ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è
  - –°–µ–∫—Ç–æ—Ä–æ–≤
  - –ì–µ–æ–≥—Ä–∞—Ñ–∏–∏
  - –í–∞–ª—é—Ç

#### Factor Tilts
–û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –±–µ–Ω—á–º–∞—Ä–∫–∞:
```
Tilt = Portfolio_Weight - Benchmark_Weight
```
–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:
- |Tilt| >= 15% ‚Üí High significance
- 5% <= |Tilt| < 15% ‚Üí Medium significance
- |Tilt| < 5% ‚Üí Low significance

## MOEX Benchmark

–í–µ—Å–∞ –∏–Ω–¥–µ–∫—Å–∞ MOEX (–¥–∞–Ω–Ω—ã–µ 2024):

**–°–µ–∫—Ç–æ—Ä—ã:**
- –§–∏–Ω–∞–Ω—Å—ã: 28.5%
- –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: 24.3%
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: 15.2%
- –¢–µ–ª–µ–∫–æ–º: 8.7%
- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π: 7.4%
- –ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ: 5.6%
- –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å: 4.8%
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: 3.2%
- –ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: 1.5%
- –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å: 0.6%
- –ü—Ä–æ—á–µ–µ: 0.2%

**–ì–µ–æ–≥—Ä–∞—Ñ–∏—è:**
- –†–æ—Å—Å–∏—è: 95.0%
- –ï–≤—Ä–æ–ø–∞: 2.5%
- –ê–∑–∏—è: 1.5%
- –°–®–ê: 0.5%
- –ü—Ä–æ—á–µ–µ: 0.5%

## –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°–µ–∫—Ç–æ—Ä–∞ (–ø—Ä–∏–º–µ—Ä—ã)
```typescript
{
  'SBER': 'finance',
  'GAZP': 'energy',
  'GMKN': 'materials',
  'YNDX': 'tech',
  'MTSS': 'telecom',
  // ... –∏ –¥—Ä—É–≥–∏–µ
}
```

### –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏–º–µ—Ä—ã)
```typescript
{
  'SBER': 5_000_000_000_000,  // 5 —Ç—Ä–ª–Ω (Large Cap)
  'VKCO': 180_000_000_000,    // 180 –º–ª—Ä–¥ (Mid Cap)
  'FIXP': 8_000_000_000,      // 8 –º–ª—Ä–¥ (Small Cap)
  // ... –∏ –¥—Ä—É–≥–∏–µ
}
```

### –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–ø—Ä–∏–º–µ—Ä—ã)
```typescript
{
  'SBER': 'russia',
  'GAZP': 'russia',
  'AAPL': 'usa',
  'MSFT': 'usa',
  // ... –∏ –¥—Ä—É–≥–∏–µ
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```tsx
import PortfolioFactors from '@/components/features/Analytics/PortfolioFactors';

export default function AnalyticsPage() {
  return (
    <div className="container mx-auto p-6">
      <PortfolioFactors />
    </div>
  );
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```tsx
import { useAnalyticsStore } from '@/stores/analyticsStore';
import SectorExposure from '@/components/features/Analytics/FactorAnalysis/SectorExposure';

export default function SectorAnalysis() {
  const { factorAnalysis } = useAnalyticsStore();

  if (!factorAnalysis) return null;

  return (
    <SectorExposure
      data={factorAnalysis.sectorExposure}
      showBenchmark={true}
      viewMode="bar"
    />
  );
}
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
```tsx
import { useAnalyticsStore } from '@/stores/analyticsStore';

function CustomAnalysis() {
  const { factorAnalysis } = useAnalyticsStore();

  if (!factorAnalysis) return null;

  // –ù–∞–π—Ç–∏ —Å–∞–º—ã–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ–∫—Ç–æ—Ä
  const topSector = factorAnalysis.sectorExposure[0];

  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∏—Å–∫ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏
  const isHighRisk = factorAnalysis.concentrationMetrics.herfindahlIndex > 0.25;

  // –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
  const significantTilts = factorAnalysis.factorTilts.sectorTilts.filter(
    tilt => tilt.significance === 'high'
  );

  return (
    <div>
      <p>–¢–æ–ø —Å–µ–∫—Ç–æ—Ä: {topSector.sector} ({topSector.weight}%)</p>
      <p>–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫: {isHighRisk ? '–î–∞' : '–ù–µ—Ç'}</p>
      <p>–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π: {significantTilts.length}</p>
    </div>
  );
}
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ —Ç–∏–∫–µ—Ä—ã
   - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–∏–∫–µ—Ä—ã –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –∫–∞–∫:
     - –°–µ–∫—Ç–æ—Ä: `other`
     - –ì–µ–æ–≥—Ä–∞—Ñ–∏—è: `russia` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
     - –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è: `mid` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

2. **MOEX Benchmark**
   - –î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã –Ω–∞ 2024 –≥–æ–¥
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

3. **–í–∞–ª—é—Ç–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**
   - –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–∏–∫–µ—Ä–∞
   - –ú–æ–∂–µ—Ç –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –≤–∞–ª—é—Ç—É —Ç–æ—Ä–≥–æ–≤–ª–∏

4. **–ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è**
   - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–∑–µ
   - –ù–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (v1.1)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–µ—Ä–æ–≤ –≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—É—é –±–∞–∑—É
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ MOEX benchmark
- [ ] Export –¥–∞–Ω–Ω—ã—Ö –≤ CSV/Excel
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏ (S&P 500, MSCI)

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (v1.2)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ
- [ ] –°–∏–º—É–ª—è—Ç–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–ª–ª–æ–∫–∞—Ü–∏–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (v2.0)
- [ ] ML-based –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–∏–∫–µ—Ä–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ ISIN/FIGI
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `recharts` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- `zustand` - state management
- `zod` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –†–∞—Å—á–µ—Ç —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞: ~50-200ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–π)
- API request: ~200-500ms
- Rendering: ~100-300ms

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. –í—ã–±—Ä–∞–Ω —Å—á–µ—Ç —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
2. API —Ç–æ–∫–µ–Ω Tinkoff –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –°—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–≤–µ—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–∫–µ—Ä–∞"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–∏–∫–µ—Ä–∞ –≤ `@/lib/analytics/portfolio/data/` (sector-map.ts, geography-map.ts)
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–∏–∫–µ—Ä –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–∞–ø–ø–∏–Ω–≥–∏
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev server

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ network tab –≤ DevTools
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Tinkoff API –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ñ–∞–∫—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ—Ä—Ç—Ñ–µ–ª—è –∏ –ø—Ä–∏–Ω—è—Ç–∏—è –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –∏ –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏.

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 23 –Ω–æ—è–±—Ä—è 2024
**–ê–≤—Ç–æ—Ä:** Claude Code
**–°—Ç–∞—Ç—É—Å:** Production Ready
